<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Hollow Knight: Silksong Save File Viewer - Analyze your save game progress">
    <title>Silksong Webweaver</title>
    <link rel="icon" href="assets/img/silksong_logo.ico" type="image/x-icon">
    <link rel="stylesheet" href="src/styles.css">
</head>

<body>
    <!-- App Layout with Sidebar -->
    <div class="app-layout">
        <!-- Sidebar Navigation -->
        <nav class="app-sidebar">
            <div class="sidebar-header">
                <img src="assets/img/silksong_logo.ico" alt="Silksong Logo" class="sidebar-logo">
                <span class="sidebar-title">Webweaver</span>
            </div>
            <ul class="sidebar-nav-list">
                <li class="sidebar-nav-item active" data-page="parser">
                    <span class="sidebar-icon">üìÅ</span>
                    <span class="sidebar-label">Parser</span>
                </li>
                <li class="sidebar-nav-item" data-page="timeline">
                    <span class="sidebar-icon">‚è±Ô∏è</span>
                    <span class="sidebar-label">Timeline</span>
                </li>
                <li class="sidebar-nav-item" data-page="map-viewer">
                    <span class="sidebar-icon">üó∫Ô∏è</span>
                    <span class="sidebar-label">Map Viewer</span>
                </li>
                <!-- Dev tool - only visible if URL has ?dev -->
                <li class="sidebar-nav-item dev-only" data-page="map-viewer-dev">
                    <span class="sidebar-icon">üîß</span>
                    <span class="sidebar-label">Map Viewer (Dev)</span>
                </li>
            </ul>
            <div class="sidebar-footer">
                <a href="https://github.com/alleriaJY/silksong-webweaver" target="_blank" class="sidebar-github">
                    <span>GitHub</span>
                </a>
            </div>
        </nav>

        <!-- Main Content Area -->
        <div class="app-main">
            <!-- Parser Page -->
            <div class="app-page active" id="page-parser">
                <div class="container">
                    <header>
                        <img src="assets/img/silksong_logo.ico" alt="Silksong Logo" class="logo">
                        <h1>Silksong: Webweaver</h1>
                        <p class="subtitle">Re-weaving the timeline</p>
                    </header>

                    <main>
                        <!-- Upload Section -->
                        <section class="upload-section">
                            <h2>Upload Save File</h2>
                            <div class="upload-area" id="upload-area">
                                <input type="file" id="file-input" accept=".dat" hidden>
                                <label for="file-input" class="upload-label">
                                    <div class="upload-icon">üìÅ</div>
                                    <span class="upload-text">Drop your .dat file here or click to browse</span>
                                    <span class="file-name" id="file-name"></span>
                                </label>
                            </div>
                            <p class="upload-hint">Your save file is processed entirely in your browser. Nothing is
                                uploaded to any
                                server.</p>

                            <!-- Analyze Button -->
                            <button class="analyze-btn" id="analyze-btn" disabled>
                                <span class="btn-icon">üîç</span>
                                <span>Analyze Save File</span>
                            </button>
                        </section>

                        <!-- Loading Indicator -->
                        <div class="loading" id="loading" hidden>
                            <div class="spinner"></div>
                            <p>Decrypting and parsing save file...</p>
                        </div>

                        <!-- Error Display -->
                        <div class="error-message" id="error-message" hidden>
                            <span class="error-icon">‚ö†Ô∏è</span>
                            <span id="error-text"></span>
                        </div>

                        <!-- Stats Section with Tabs -->
                        <section class="stats-section" id="stats-section" hidden>
                            <h2>üìä Save File Statistics</h2>

                            <!-- Tab Navigation -->
                            <nav class="tab-nav" id="tab-nav">
                                <button class="tab-btn active" data-tab="general">
                                    <span class="tab-text">GENERAL</span>
                                </button>
                                <button class="tab-btn" data-tab="current">
                                    <span class="tab-text">CURRENT STATS</span>
                                </button>
                                <button class="tab-btn" data-tab="misc">
                                    <span class="tab-text">MISC</span>
                                </button>
                                <button class="tab-btn" data-tab="abilities">
                                    <span class="tab-text">ABILITIES</span>
                                </button>
                                <button class="tab-btn" data-tab="skills">
                                    <span class="tab-text">SKILLS</span>
                                </button>
                                <button class="tab-btn" data-tab="tools">
                                    <span class="tab-text">TOOLS</span>
                                </button>
                                <button class="tab-btn" data-tab="bosses">
                                    <span class="tab-text">BOSSES</span>
                                </button>
                                <button class="tab-btn" data-tab="fleas">
                                    <span class="tab-text">FLEAS</span>
                                </button>
                                <button class="tab-btn" data-tab="maps">
                                    <span class="tab-text">MAPS</span>
                                </button>
                                <button class="tab-btn" data-tab="collectables">
                                    <span class="tab-text">COLLECTABLES</span>
                                </button>
                            </nav>

                            <!-- Tab Panels -->
                            <div class="tab-panels">

                                <!-- 1. General Tab -->
                                <div class="tab-panel active" id="panel-general">
                                    <div class="panel-header">
                                        <h3>General Information</h3>
                                        <p class="panel-description">Overview of your save file</p>
                                    </div>
                                    <div class="panel-content">
                                        <!-- Game Info Card -->
                                        <div class="stat-card">
                                            <h4>üéÆ Game Info</h4>
                                            <div class="stat-row">
                                                <span class="stat-label">Game Version</span>
                                                <span class="stat-value" data-stat="version">-</span>
                                            </div>
                                            <div class="stat-row">
                                                <span class="stat-label">Game Mode</span>
                                                <span class="stat-value" data-stat="permadeath">-</span>
                                            </div>
                                            <div class="stat-row">
                                                <span class="stat-label">Completion</span>
                                                <span class="stat-value highlight" data-stat="completion">-</span>
                                            </div>
                                            <div class="stat-row">
                                                <span class="stat-label">Play Time</span>
                                                <span class="stat-value highlight" data-stat="playTime">-</span>
                                            </div>
                                        </div>

                                        <!-- Max Unlocked Card -->
                                        <div class="stat-card">
                                            <h4>‚¨ÜÔ∏è Stats</h4>
                                            <div class="stat-row">
                                                <span class="stat-label">Max Health</span>
                                                <span class="stat-value" data-stat="maxHealth">-</span>
                                            </div>
                                            <div class="stat-row">
                                                <span class="stat-label">Max Silk</span>
                                                <span class="stat-value" data-stat="maxSilk">-</span>
                                            </div>
                                            <div class="stat-row">
                                                <span class="stat-label">Max Silk Hearts</span>
                                                <span class="stat-value" data-stat="silkHearts">-</span>
                                            </div>
                                        </div>

                                        <!-- Stats Visual - Full Width -->
                                        <div class="stat-card full-width">
                                            <h4>‚ù§Ô∏è Health & Silk Visual</h4>
                                            <div class="stat-visual-row">
                                                <span class="stat-visual-label">Max Health:</span>
                                                <div class="icon-container" id="health-icons">
                                                    <!-- Health icons will be populated by JS -->
                                                </div>
                                            </div>
                                            <div class="stat-visual-row">
                                                <span class="stat-visual-label">Silk Hearts:</span>
                                                <div class="icon-container" id="silkheart-icons">
                                                    <!-- Silk heart icons will be populated by JS -->
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- 2. Current Stats Tab -->
                                <div class="tab-panel" id="panel-current">
                                    <div class="panel-header">
                                        <h3>Current Stats</h3>
                                        <p class="panel-description">Your current in-game status</p>
                                    </div>
                                    <div class="panel-content">
                                        <!-- Health & Silk Card -->
                                        <div class="stat-card">
                                            <h4>‚ù§Ô∏è Health & Silk</h4>
                                            <div class="stat-row">
                                                <span class="stat-label">Current Health</span>
                                                <span class="stat-value" data-stat="healthDisplay">-</span>
                                            </div>
                                            <div class="stat-bar" id="health-bar">
                                                <div class="stat-bar-fill health-fill" id="health-fill"></div>
                                            </div>
                                            <div class="stat-row">
                                                <span class="stat-label">Current Silk</span>
                                                <span class="stat-value" data-stat="silkDisplay">-</span>
                                            </div>
                                            <div class="stat-bar" id="silk-bar">
                                                <div class="stat-bar-fill silk-fill" id="silk-fill"></div>
                                            </div>
                                        </div>

                                        <!-- Currency Card -->
                                        <div class="stat-card">
                                            <h4>üí∞ Currency</h4>
                                            <div class="stat-row">
                                                <span class="stat-label"><img
                                                        src="assets/img/general/general_rosaries.png" alt="Rosary"
                                                        class="stat-icon"> Rosaries</span>
                                                <span class="stat-value highlight" data-stat="geo">-</span>
                                            </div>
                                            <div class="stat-row">
                                                <span class="stat-label"><img src="assets/img/general/general_shard.png"
                                                        alt="Shell Shard" class="stat-icon"> Shell Shards</span>
                                                <span class="stat-value" data-stat="shellShards">-</span>
                                            </div>
                                        </div>

                                        <!-- Equipment Card with Crest Image -->
                                        <div class="stat-card full-width">
                                            <h4>‚öîÔ∏è Equipment</h4>
                                            <div class="crest-display">
                                                <img src="assets/img/general/crests/Select_Game_Crest_Spools__0000_hunter.png"
                                                    alt="Equipped Crest" id="crest-image" class="crest-image">
                                            </div>
                                            <div class="stat-row">
                                                <span class="stat-label">Equipped Crest</span>
                                                <span class="stat-value" data-stat="crest">-</span>
                                            </div>
                                            <!-- Equipped Tools Row -->
                                            <div class="equipped-tools-section">
                                                <span class="stat-visual-label">Equipped Tools:</span>
                                                <div class="equipped-tools-row" id="equipped-tools-row">
                                                    <!-- Tool icons will be populated by JS -->
                                                </div>
                                            </div>
                                            <!-- Extra Tools Row -->
                                            <div class="equipped-tools-section">
                                                <span class="stat-visual-label">Extra Slots:</span>
                                                <div class="equipped-tools-row" id="extra-tools-row">
                                                    <!-- Extra tool icons will be populated by JS -->
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Current Position Card -->
                                        <div class="stat-card">
                                            <h4>üìç Current Position</h4>
                                            <div class="stat-row">
                                                <span class="stat-label">Current Area</span>
                                                <span class="stat-value highlight" data-stat="currentArea">-</span>
                                            </div>
                                            <div class="stat-row">
                                                <span class="stat-label">Map Zone</span>
                                                <span class="stat-value" data-stat="mapZone">-</span>
                                            </div>
                                            <div class="stat-row">
                                                <span class="stat-label">At Bench</span>
                                                <span class="stat-value" data-stat="atBench">-</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- 3. Misc Tab -->
                                <div class="tab-panel" id="panel-misc">
                                    <div class="panel-header">
                                        <h3>Miscellaneous</h3>
                                        <p class="panel-description">Additional save file details</p>
                                    </div>
                                    <div class="panel-content">
                                        <!-- Respawn Info Card -->
                                        <div class="stat-card">
                                            <h4>üîÑ Respawn Info</h4>
                                            <div class="stat-row">
                                                <span class="stat-label">Respawn Area</span>
                                                <span class="stat-value" data-stat="respawnScene">-</span>
                                            </div>
                                            <div class="stat-row">
                                                <span class="stat-label">Respawn Marker</span>
                                                <span class="stat-value" data-stat="respawnMarker">-</span>
                                            </div>
                                        </div>

                                        <!-- Save Info Card -->
                                        <div class="stat-card">
                                            <h4>üìù Save Info</h4>
                                            <div class="stat-row">
                                                <span class="stat-label">Respawn Type</span>
                                                <span class="stat-value" data-stat="respawnType">-</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- 4. Abilities Tab -->
                                <div class="tab-panel" id="panel-abilities">
                                    <div class="panel-header">
                                        <h3>Abilities</h3>
                                        <p class="panel-description">Unlocked: <span
                                                id="abilities-unlocked-count">0</span>/8
                                        </p>
                                    </div>
                                    <div class="panel-content">
                                        <div class="stat-card full-width">
                                            <h4>ü¶ã Movement Abilities</h4>
                                            <div class="abilities-grid" id="abilities-grid">
                                                <!-- Ability icons will be populated by JS -->
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- 5. Skills Tab -->
                                <div class="tab-panel" id="panel-skills">
                                    <div class="panel-header">
                                        <h3>Skills</h3>
                                        <p class="panel-description">Unlocked: <span
                                                id="skills-unlocked-count">0</span>/6
                                        </p>
                                    </div>
                                    <div class="panel-content">
                                        <div class="stat-card full-width">
                                            <h4>‚öîÔ∏è Combat Skills</h4>
                                            <div class="skills-grid" id="skills-grid">
                                                <!-- Skill icons will be populated by JS -->
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- 6. Tools Tab -->
                                <div class="tab-panel" id="panel-tools">
                                    <div class="panel-header">
                                        <h3>Tools</h3>
                                        <p class="panel-description">Unlocked: <span
                                                id="tools-unlocked-count">0</span>/59 | Seen:
                                            <span id="tools-seen-count">0</span>/59
                                        </p>
                                    </div>
                                    <div class="panel-content">
                                        <div class="stat-card full-width">
                                            <h4>üîß Tool Collection</h4>
                                            <div class="tools-grid" id="tools-grid">
                                                <!-- Tool icons will be populated by JS -->
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- 5. Bosses Tab -->
                                <div class="tab-panel" id="panel-bosses">
                                    <div class="panel-header">
                                        <h3>Bosses</h3>
                                        <p class="panel-description">Boss encounters defeated (<span
                                                id="bosses-count">0</span>/36)
                                        </p>
                                    </div>
                                    <div class="panel-content">
                                        <div class="stat-card full-width">
                                            <h4>‚öîÔ∏è Boss Encounters</h4>
                                            <div class="bosses-grid" id="bosses-grid">
                                                <!-- Boss icons will be populated by JS -->
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- 6. Fleas Tab (Placeholder) -->
                                <div class="tab-panel" id="panel-fleas">
                                    <div class="panel-header">
                                        <h3>Fleas</h3>
                                        <p class="panel-description">Flea encounters</p>
                                    </div>
                                    <div class="panel-content">
                                        <div class="placeholder-card">
                                            <p>Flea tracking coming soon!</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- 7. Maps Tab -->
                                <div class="tab-panel" id="panel-maps">
                                    <div class="panel-header">
                                        <h3>Maps</h3>
                                        <p class="panel-description">Collected area maps (<span
                                                id="maps-count">0</span>/28)</p>
                                    </div>
                                    <div class="panel-content">
                                        <div class="stat-card full-width">
                                            <h4>üó∫Ô∏è Area Maps</h4>
                                            <div class="maps-grid" id="maps-grid">
                                                <!-- Map icons will be populated by JS -->
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- 7. Collectables Tab (Placeholder) -->
                                <div class="tab-panel" id="panel-collectables">
                                    <div class="panel-header">
                                        <h3>Collectables</h3>
                                        <p class="panel-description">Items and collectables found</p>
                                    </div>
                                    <div class="panel-content">
                                        <div class="placeholder-card">
                                            <p>Collectable tracking coming soon!</p>
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </section>
                    </main>

                    <footer>
                        <p>Silksong Webweaver &copy; <span id="current-year"></span> |
                            <a href="https://github.com/alleriaJY/silksong-webweaver" target="_blank">GitHub</a>
                        </p>
                        <p class="footer-note">Powered by Rust + WebAssembly</p>
                    </footer>
                </div>
            </div>
            <!-- End Parser Page -->

            <!-- Timeline Page -->
            <div class="app-page" id="page-timeline">
                <iframe src="exploration_timeline.html" class="map-viewer-iframe" title="Exploration Timeline"></iframe>
            </div>
            <!-- End Timeline Page -->

            <!-- Map Viewer Page (Production - confirmed tiles only) -->
            <div class="app-page" id="page-map-viewer">
                <iframe src="map_viewer.html" class="map-viewer-iframe" title="Pharloom Map Viewer"></iframe>
            </div>
            <!-- End Map Viewer Page -->

            <!-- Map Viewer Dev Page (for tile confirmation) -->
            <div class="app-page" id="page-map-viewer-dev">
                <iframe src="tile_overlay_viewer.html" class="map-viewer-iframe" title="Map Viewer Dev"></iframe>
            </div>
            <!-- End Map Viewer Dev Page -->
        </div>
        <!-- End app-main -->
    </div>
    <!-- End app-layout -->

    <script type="module" src="src/main.js"></script>

    <!-- Sidebar Navigation Script -->
    <script>
        // Show dev nav item only if ?dev in URL
        if (window.location.search.includes('dev')) {
            const devNavItem = document.querySelector('[data-page="map-viewer-dev"]');
            if (devNavItem) devNavItem.style.display = 'flex';
        }

        // Sidebar page navigation
        document.querySelectorAll('.sidebar-nav-item').forEach(item => {
            item.addEventListener('click', () => {
                // Update active nav item
                document.querySelectorAll('.sidebar-nav-item').forEach(nav => nav.classList.remove('active'));
                item.classList.add('active');

                // Show corresponding page
                const pageId = 'page-' + item.dataset.page;
                document.querySelectorAll('.app-page').forEach(page => page.classList.remove('active'));
                document.getElementById(pageId).classList.add('active');
            });
        });
    </script>
</body>

</html>